version: "3.9"

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        INSTALL_ML_DEPS: "true"
        DOWNLOAD_MODELS: "true"
    image: tryon-api
    environment:
      - TRYON_OUTPUTS_DIR=/tmp/tryon/outputs
      - TRYON_UPLOADS_DIR=/tmp/tryon/uploads
      - STABLEVITON_SHAREPOINT_URL
      - SCHP_DRIVE_URL
      - INSTANTID_ANTELOPE_URL
    ports:
      - "8008:8008"
    volumes:
      - ./outputs:/tmp/tryon/outputs
      - ./uploads:/tmp/tryon/uploads

  web:
    image: node:20-alpine
    working_dir: /app
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port 5173"
    volumes:
      - ./sdk/web:/app
    ports:
      - "5173:5173"
    depends_on:
      - api
